CREATE View [AMS].[VIEW_JOURNALVOUCHER] as
SELECT ROW_NUMBER() OVER (ORDER BY Voucher_No,Debit_Amt DESC,Credit_Amt asc,Serial_No,Voucher_Miti,Voucher_Time) AS SNo,Voucher_No [VOUCHER NO],Voucher_Date [VOUCHER DATE],Voucher_Miti [VOUCHER MITI],GL.GLName [LEDGER DESC],GLC.GLName [CASH LEDGER],ISNULL(SL.SLName,'No Subledger') [SUBLEDGER DESC],AgentName [SALES MAN],DP.DName [DEPARTMENT 1ST],DP1.DName [DEPARTMENT 2ND],DP2.DName [DEPARTMENT 3RD],DP3.DName [DEPARTMENT 4TH],
Currency_Rate [CURRENCY RATE],Debit_Amt [DEBIT AMOUNT],LocalDebit_Amt [NPR DEBIT AMOUNT],Credit_Amt [CREDIT AMOUNT],LocalCredit_Amt [NPR CREDIT AMOUNT], DueDays [DUE DAYS], DueDate [DUE DATE], Narration [NARRATION],
Remarks [REMARKS], RefNo [REF NO],RefDate[REF DATE],Reconcile_By [RECONCILE BY], Reconcile_Date [RECONCILE DATE],Authorize_By [AUTHORISIED BY],Clearing_By [CLEARING BY],Clearing_Date [CLEARING DATE],Branch_Name [BRANCH DESC],CmpUnit_Name [COMPANYUNIT DESC],AD.EnterBy [ENTERY USER],AD.EnterDate [ENTRY DATE] FROM AMS.AccountDetails  AS AD
LEFT OUTER JOIN AMS.GeneralLedger AS GL ON GL.GLID=AD.Ledger_ID LEFT OUTER JOIN AMS.GeneralLedger AS GLC ON GLC.GLID=AD.CbLedger_ID LEFT OUTER JOIN AMS.Subledger AS SL ON SL.SLId=AD.Subleder_ID
LEFT OUTER JOIN AMS.JuniorAgent AS JA ON JA.AgentId=AD.Agent_ID LEFT OUTER JOIN AMS.Department AS DP ON DP.DId =AD.Department_ID1 LEFT OUTER JOIN AMS.Department AS DP1 ON DP1.DId =AD.Department_ID2
LEFT OUTER JOIN AMS.Department AS DP2 ON DP2.DId =AD.Department_ID3 LEFT OUTER JOIN AMS.Department AS DP3 ON DP3.DId =AD.Department_ID4 LEFT OUTER JOIN AMS.Currency AS C ON C.CId =AD.Currency_ID
LEFT OUTER JOIN AMS.Branch AS B ON B.Branch_Id =AD.Branch_ID LEFT OUTER JOIN AMS.CompanyUnit AS CU ON CU.CmpUnit_Id =AD.CmpUnit_ID WHERE Module='PB'
